<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnvÃ­o de Correos - DistribuciÃ³n de IDs de Estudiantes</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            width: 100px;
            height: auto;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        h1 {
            color: #1e40af;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .instructions {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            line-height: 1.6;
            color: #374151;
        }

        .student-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .student-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-name {
            font-weight: 600;
            color: #111827;
        }

        .student-id {
            background: #1e40af;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #374151;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input[type="email"], input[type="text"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .email-preview {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            font-size: 12px;
            line-height: 1.4;
            color: #374151;
            max-height: 200px;
            overflow-y: auto;
        }

        .email-subject {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .success-message {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            color: #065f46;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .student-inputs {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="images/Logo-CLM-V1.jpg" alt="Logo CLM" class="logo">
            <h1>EnvÃ­o de IDs por Correo ElectrÃ³nico</h1>
            <p class="subtitle">ProducciÃ³n Oral B2.1 - Universidad de Granada</p>
        </div>

        <div class="instructions">
            <h3>ğŸ“§ Instrucciones:</h3>
            <ol>
                <li><strong>Verifica los correos de los estudiantes</strong> ya precargados abajo</li>
                <li><strong>Previsualiza los emails personalizados</strong> para cada estudiante</li>
                <li><strong>Copia el contenido del email</strong> y envÃ­a vÃ­a tu cliente de correo preferido</li>
                <li><strong>Marca como enviado</strong> con los checkboxes para llevar seguimiento</li>
            </ol>
            <p style="margin-top: 10px; color: #6b7280;">
                <strong>Nota:</strong> Este sistema genera emails personalizados que puedes copiar y pegar en Gmail, Outlook, etc.
            </p>
        </div>

        <div class="student-inputs" id="studentInputs">
            <!-- Student cards will be generated here -->
        </div>

        <div class="success-message" id="successMessage">
            âœ… Â¡Todos los emails preparados correctamente! Ahora puedes copiar y enviar cada email individualmente.
        </div>

        <div class="buttons">
            <button class="btn btn-primary" onclick="generateAllEmails()">
                ğŸ“§ Generar Todos los Emails
            </button>
            <button class="btn btn-success" onclick="copyAllEmails()">
                ğŸ“‹ Copiar Todo el Contenido
            </button>
            <button class="btn btn-secondary" onclick="window.open('attendance-admin.html', '_blank')">
                ğŸ“Š Ir al Panel de AdministraciÃ³n
            </button>
            <button class="btn btn-secondary" onclick="window.open('student-ids-reference.html', '_blank')">
                ğŸ” Ver Referencia de Estudiantes
            </button>
        </div>
    </div>

    <!-- Modal for email preview -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Email Preview</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Email content will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // Students data with IDs and variants - ORDERED ACCORDING TO PROFESSOR'S LIST
        const STUDENTS_DATA = [
            {
                id: '2847',
                fullName: 'CHAFFIN, NATHANIEL HAYEN',
                email: 'nhchaf27@g.holycross.edu',
                variants: ['Nathaniel Chaffin', 'Nathaniel', 'N. Chaffin', 'Nat', 'Chaffin'],
                likelyChinese: false
            },
            {
                id: '1523',
                fullName: 'BAI, MIAORUI',
                email: 'A-ruui@outlook.com',
                variants: ['Miaorui Bai', 'Miaorui', 'M. Bai', 'Bai'],
                likelyChinese: true
            },
            {
                id: '8901',
                fullName: 'MOREY, GABRIELLE KAI',
                email: 'gabkaimo@gmail.com',
                variants: ['Gabrielle Morey', 'Gabrielle', 'G. Morey', 'Morey', 'Kai'],
                likelyChinese: false
            },
            {
                id: '5789',
                fullName: 'LANTER, WESLEY MITCHELL',
                email: 'wlanter3@gatech.edu',
                variants: ['Wesley Lanter', 'Wesley', 'W. Lanter', 'Lanter'],
                likelyChinese: false
            },
            {
                id: '6134',
                fullName: 'MANCIPE, GABRIEL FELIPE',
                email: 'gafeli@unc.edu',
                variants: ['Gabriel Mancipe', 'Gabriel', 'G. Mancipe', 'Mancipe'],
                likelyChinese: false
            },
            {
                id: '7256',
                fullName: 'MIRANDA, MARISOL ESPERANZA',
                email: 'marisol.e.miranda0301@gmail.com',
                variants: ['Marisol Miranda', 'Marisol', 'M. Miranda', 'Miranda'],
                likelyChinese: false
            },
            {
                id: '9467',
                fullName: 'PORTZLINE, EVAN GRACE',
                email: 'eportz30@gmail.com',
                variants: ['Evan Portzline', 'Evan', 'E. Portzline', 'Portzline'],
                likelyChinese: false
            },
            {
                id: '4602',
                fullName: 'KEMPF, RYAN ELIZABETH',
                email: 'ryankpink@icloud.com',
                variants: ['Ryan Kempf', 'Ryan', 'R. Kempf', 'Kempf'],
                likelyChinese: false
            },
            {
                id: '3915',
                fullName: 'DIAZ, ANGELA CLARICE',
                email: 'angela.diaz468@myci.csuci.edu',
                variants: ['Angela Diaz', 'Angela', 'A. Diaz', 'Diaz'],
                likelyChinese: false
            },
            {
                id: '1089',
                fullName: 'SALAZAR, NATALIE',
                email: 'natalie.salazar427@myci.csuci.edu',
                variants: ['Natalie Salazar', 'Natalie', 'N. Salazar', 'Salazar'],
                likelyChinese: false
            }
        ];

        function initializeStudentInputs() {
            const container = document.getElementById('studentInputs');

            STUDENTS_DATA.forEach((student, index) => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.fullName}</div>
                        <div class="student-id">ID: ${student.id}</div>
                    </div>

                    <div class="form-group">
                        <label for="email-${index}">Email del Estudiante:</label>
                        <input type="email" id="email-${index}" value="${student.email}" placeholder="student@ugr.es">
                    </div>

                    <div class="form-group">
                        <label>Vista Previa del Email:</label>
                        <div class="email-preview" id="preview-${index}">
                            <div class="email-subject">Asunto: Tu ID de Asistencia - Curso de EspaÃ±ol Oral B2.1</div>
                            <em>El email personalizado aparecerÃ¡ aquÃ­...</em>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="checkbox" id="sent-${index}" onchange="updateProgress()">
                        <label for="sent-${index}" style="margin: 0; font-size: 14px;">Email enviado</label>
                        <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px;" onclick="previewEmail(${index})">
                            ğŸ‘ï¸ Vista Previa
                        </button>
                        <button class="btn btn-success" style="padding: 6px 12px; font-size: 14px;" onclick="copyEmail(${index})">
                            ğŸ“‹ Copiar
                        </button>
                    </div>
                `;

                container.appendChild(card);

                // Generate initial preview with preloaded email
                generateEmailPreview(index);

                // Add email input listener
                document.getElementById(`email-${index}`).addEventListener('input', () => {
                    generateEmailPreview(index);
                });
            });
        }

        function generateEmailContent(student, email) {
            const firstName = student.fullName.split(',')[1] || student.fullName.split(',')[0];
            const firstNameTrimmed = firstName.trim();

            // Check if we need Chinese version
            const chineseSection = student.likelyChinese ? `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ä¸­æ–‡ç‰ˆæœ¬ / CHINESE VERSIONã€‘

ä½ å¥½${firstNameTrimmed}ï¼

æ¬¢è¿ä½¿ç”¨è¥¿ç­ç‰™è¯­å£è¯­B2.1è¯¾ç¨‹ç­¾åˆ°ç³»ç»Ÿï¼

ğŸ¯ **ä½ çš„ä¸ªäººä¿¡æ¯ / Your Personal Information:**
â€¢ å…¨å / Full Name: ${student.fullName}
â€¢ å­¦ç”ŸID / Student ID: ${student.id}
â€¢ å¯æ¥å—çš„å§“åå˜ä½“ / Accepted Name Variants: ${student.variants.join(', ')}

ğŸ“± **å¦‚ä½•ç­¾åˆ° / How to Register Attendance:**

1ï¸âƒ£ **æ‰«æäºŒç»´ç  / Scan QR Code:**
   - ç”¨æ‰‹æœºæ‘„åƒå¤´æ‰«ææ•™å®¤é‡Œçš„äºŒç»´ç 
   - Use your phone camera to scan the QR code

2ï¸âƒ£ **å¡«å†™è¡¨æ ¼ / Fill the Form:**
   - è¾“å…¥ä½ çš„å§“åï¼ˆå¯ä»¥ä½¿ç”¨åˆ—è¡¨ä¸­çš„ä»»ä½•å˜ä½“ï¼‰
   - Enter your name (you can use any variant from the list)
   - è¾“å…¥ä½ çš„4ä½å­¦ç”ŸID: ${student.id}
   - Enter your 4-digit Student ID: ${student.id}
   - ç‚¹å‡»"Registrar Asistencia"
   - Click "Registrar Asistencia"

âš ï¸ **é‡è¦æé†’ / Important Notes:**
â€¢ ä½ çš„IDæ˜¯å”¯ä¸€çš„ï¼Œè¯·å‹¿ä¸ä»–äººåˆ†äº«
â€¢ Your ID is unique - please don't share it with others
â€¢ ç³»ç»Ÿä½¿ç”¨ç§»åŠ¨æ•°æ®ï¼Œæ— éœ€WiFi
â€¢ System works with mobile data, no WiFi needed

å¦‚æœ‰é—®é¢˜è¯·è”ç³»æ•™æˆ / Contact professor if you have issues
` : '';

            const body = `Â¡Hola ${firstNameTrimmed}!

Bienvenido/a al curso de ProducciÃ³n Oral B2.1 en la Universidad de Granada.

Te escribo para proporcionarte tu ID personal de asistencia para nuestro curso.

ğŸ¯ **Tus Datos Personales:**
â€¢ Nombre completo: ${student.fullName}
â€¢ ID de Estudiante: ${student.id}
â€¢ Variantes de nombre aceptadas: ${student.variants.join(', ')}

ğŸ“± **CÃ³mo Registrar Tu Asistencia:**

1ï¸âƒ£ **Escanea el CÃ³digo QR:**
   - Busca el cÃ³digo QR que se mostrarÃ¡ en clase
   - Usa la cÃ¡mara de tu mÃ³vil para escanearlo
   - Se abrirÃ¡ automÃ¡ticamente la pÃ¡gina de asistencia

2ï¸âƒ£ **Rellena el Formulario:**
   - Escribe tu nombre (puedes usar cualquiera de las variantes listadas arriba)
   - Introduce tu ID de estudiante de 4 dÃ­gitos: ${student.id}
   - Haz clic en "Registrar Asistencia"

3ï¸âƒ£ **ConfirmaciÃ³n:**
   - VerÃ¡s un mensaje de Ã©xito con los detalles de tu registro
   - El sistema registra la hora exacta de tu llegada
   - Solo puedes registrarte una vez al dÃ­a

âš ï¸ **Notas Importantes:**
â€¢ Tu ID es Ãºnico y confidencial - no lo compartas con otros
â€¢ Debes usar AMBOS: tu nombre (cualquier variante aceptada) Y tu ID correcto
â€¢ El sistema funciona con datos mÃ³viles - no necesitas WiFi
â€¢ RegÃ­strate cuando llegues a clase

ğŸ”§ **Si tienes problemas:**
- Verifica que estÃ¡s usando el ID correcto de 4 dÃ­gitos
- Prueba usando una variante diferente de nombre de la lista
- ContÃ¡ctame si necesitas ayuda

Â¡Espero verte en clase!

Saludos cordiales,
Javier BenÃ­tez LÃ¡inez
Profesor de EspaÃ±ol
Centro de Lenguas Modernas
Universidad de Granada${chineseSection}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Hello ${firstNameTrimmed}!

Welcome to the Spanish Oral Production Course B2.1 at Universidad de Granada.

I'm writing to provide you with your personal attendance ID for our course.

ğŸ¯ **Your Personal Information:**
â€¢ Full Name: ${student.fullName}
â€¢ Student ID: ${student.id}
â€¢ Accepted Name Variants: ${student.variants.join(', ')}

ğŸ“± **How to Register Your Attendance:**

1ï¸âƒ£ **Scan the QR Code:**
   - Look for the QR code displayed in class
   - Use your phone's camera to scan it
   - It will automatically open the attendance page

2ï¸âƒ£ **Fill the Form:**
   - Enter your name (you can use any of the variants listed above)
   - Enter your 4-digit Student ID: ${student.id}
   - Click "Registrar Asistencia"

3ï¸âƒ£ **Confirmation:**
   - You'll see a success message with your registration details
   - The system records the exact time of your arrival
   - You can only register once per day

âš ï¸ **Important Notes:**
â€¢ Your ID is unique and confidential - don't share it with others
â€¢ You must use BOTH your name (any accepted variant) AND your correct ID
â€¢ The system works with mobile data - no WiFi needed
â€¢ Make sure to register when you arrive at class

ğŸ”§ **If you have any issues:**
- Double-check that you're using the correct 4-digit ID
- Try using a different name variant from the list above
- Contact me if you need assistance

I look forward to seeing you in class!

Best regards,
Javier BenÃ­tez LÃ¡inez
Spanish Language Professor
Centro de Lenguas Modernas
Universidad de Granada`;

            const subject = `Tu ID de Asistencia - EspaÃ±ol B2.1 / Your Attendance ID - Spanish B2.1`;

            return { subject, body };
        }

        function generateEmailPreview(index) {
            const email = document.getElementById(`email-${index}`).value;
            const preview = document.getElementById(`preview-${index}`);
            const student = STUDENTS_DATA[index];

            if (!email) {
                preview.innerHTML = '<div class="email-subject">Asunto: Tu ID de Asistencia - Curso de EspaÃ±ol Oral B2.1</div><em>Introduce una direcciÃ³n de email para ver el contenido personalizado...</em>';
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            preview.innerHTML = `
                <div class="email-subject">Asunto: ${subject}</div>
                <div style="white-space: pre-line;">${body}</div>
            `;
        }

        function previewEmail(index) {
            const email = document.getElementById(`email-${index}`).value;
            const student = STUDENTS_DATA[index];

            if (!email) {
                alert('Por favor, introduce una direcciÃ³n de email primero.');
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>Para / To:</strong> ${email}<br>
                    <strong>Asunto / Subject:</strong> ${subject}
                </div>
                <div style="background: #f9fafb; padding: 20px; border-radius: 8px; white-space: pre-line; line-height: 1.6;">
                    ${body}
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="copyEmail(${index}); closeModal();">
                        ğŸ“‹ Copiar al Portapapeles / Copy to Clipboard
                    </button>
                </div>
            `;

            document.getElementById('emailModal').style.display = 'block';
        }

        function copyEmail(index) {
            const email = document.getElementById(`email-${index}`).value;
            const student = STUDENTS_DATA[index];

            if (!email) {
                alert('Por favor, introduce una direcciÃ³n de email primero.');
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            const emailContent = `Para / To: ${email}
Asunto / Subject: ${subject}

${body}`;

            navigator.clipboard.writeText(emailContent).then(() => {
                alert('Â¡Email copiado al portapapeles! Ahora puedes pegarlo en tu cliente de correo.');
            }).catch(err => {
                console.error('Error al copiar email: ', err);
                alert('Error al copiar email. Por favor, intÃ©ntalo de nuevo.');
            });
        }

        function generateAllEmails() {
            for (let i = 0; i < STUDENTS_DATA.length; i++) {
                generateEmailPreview(i);
            }

            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
        }

        function copyAllEmails() {
            let allEmails = '';
            let emailCount = 0;

            for (let i = 0; i < STUDENTS_DATA.length; i++) {
                const email = document.getElementById(`email-${i}`).value;
                const student = STUDENTS_DATA[i];

                if (email) {
                    const { subject, body } = generateEmailContent(student, email);
                    allEmails += `=== EMAIL ${++emailCount} ===
Para / To: ${email}
Asunto / Subject: ${subject}

${body}

========================

`;
                }
            }

            if (allEmails) {
                navigator.clipboard.writeText(allEmails).then(() => {
                    alert(`Â¡${emailCount} emails copiados al portapapeles! Ahora puedes pegarlos en tu cliente de correo.`);
                });
            } else {
                alert('Por favor, introduce al menos una direcciÃ³n de email primero.');
            }
        }

        function closeModal() {
            document.getElementById('emailModal').style.display = 'none';
        }

        function updateProgress() {
            // This function could be used to show progress of sent emails
            const total = STUDENTS_DATA.length;
            let sent = 0;

            for (let i = 0; i < total; i++) {
                if (document.getElementById(`sent-${i}`).checked) {
                    sent++;
                }
            }

            // You could update a progress bar here if desired
            console.log(`Progress: ${sent}/${total} emails sent`);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('emailModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeStudentInputs);
    </script>
</body>
</html>