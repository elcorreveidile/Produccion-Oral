<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Env√≠o de Correos - Distribuci√≥n de IDs de Estudiantes</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            width: 100px;
            height: auto;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        h1 {
            color: #1e40af;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .instructions {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            line-height: 1.6;
            color: #374151;
        }

        .student-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .student-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-name {
            font-weight: 600;
            color: #111827;
        }

        .student-id {
            background: #1e40af;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #374151;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input[type="email"], input[type="text"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .email-preview {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            font-size: 12px;
            line-height: 1.4;
            color: #374151;
            max-height: 200px;
            overflow-y: auto;
        }

        .email-subject {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .success-message {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            color: #065f46;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .student-inputs {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="images/Logo-CLM-V1.jpg" alt="Logo CLM" class="logo">
            <h1>Env√≠o de IDs por Correo Electr√≥nico</h1>
            <p class="subtitle">Producci√≥n Oral B2.1 - Universidad de Granada</p>
        </div>

        <div class="instructions">
            <h3>üìß Instrucciones:</h3>
            <ol>
                <li><strong>Verifica los correos de los estudiantes</strong> ya precargados abajo</li>
                <li><strong>Previsualiza los emails personalizados</strong> para cada estudiante</li>
                <li><strong>Copia el contenido del email</strong> y env√≠a v√≠a tu cliente de correo preferido</li>
                <li><strong>Marca como enviado</strong> con los checkboxes para llevar seguimiento</li>
            </ol>
            <p style="margin-top: 10px; color: #6b7280;">
                <strong>Nota:</strong> Este sistema genera emails personalizados que puedes copiar y pegar en Gmail, Outlook, etc.
            </p>
        </div>

        <div class="student-inputs" id="studentInputs">
            <!-- Student cards will be generated here -->
        </div>

        <div class="success-message" id="successMessage">
            ‚úÖ ¬°Todos los emails preparados correctamente! Ahora puedes copiar y enviar cada email individualmente.
        </div>

        <div class="buttons">
            <button class="btn btn-primary" onclick="generateAllEmails()">
                üìß Generar Todos los Emails
            </button>
            <button class="btn btn-success" onclick="copyAllEmails()">
                üìã Copiar Todo el Contenido
            </button>
            <button class="btn btn-secondary" onclick="window.open('attendance-admin.html', '_blank')">
                üìä Ir al Panel de Administraci√≥n
            </button>
            <button class="btn btn-secondary" onclick="window.open('student-ids-reference.html', '_blank')">
                üîç Ver Referencia de Estudiantes
            </button>
        </div>
    </div>

    <!-- Modal for email preview -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Email Preview</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Email content will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // Students data with IDs and variants - ORDERED ACCORDING TO PROFESSOR'S LIST
        const STUDENTS_DATA = [
            {
                id: '2847',
                fullName: 'CHAFFIN, NATHANIEL HAYEN',
                email: 'nhchaf27@g.holycross.edu',
                variants: ['Nathaniel Chaffin', 'Nathaniel', 'N. Chaffin', 'Nat', 'Chaffin']
            },
            {
                id: '1523',
                fullName: 'BAI, MIAORUI',
                email: 'A-ruui@outlook.com',
                variants: ['Miaorui Bai', 'Miaorui', 'M. Bai', 'Bai']
            },
            {
                id: '8901',
                fullName: 'MOREY, GABRIELLE KAI',
                email: 'gabkaimo@gmail.com',
                variants: ['Gabrielle Morey', 'Gabrielle', 'G. Morey', 'Morey', 'Kai']
            },
            {
                id: '5789',
                fullName: 'LANTER, WESLEY MITCHELL',
                email: 'wlanter3@gatech.edu',
                variants: ['Wesley Lanter', 'Wesley', 'W. Lanter', 'Lanter']
            },
            {
                id: '6134',
                fullName: 'MANCIPE, GABRIEL FELIPE',
                email: 'gafeli@unc.edu',
                variants: ['Gabriel Mancipe', 'Gabriel', 'G. Mancipe', 'Mancipe']
            },
            {
                id: '7256',
                fullName: 'MIRANDA, MARISOL ESPERANZA',
                email: 'marisol.e.miranda0301@gmail.com',
                variants: ['Marisol Miranda', 'Marisol', 'M. Miranda', 'Miranda']
            },
            {
                id: '9467',
                fullName: 'PORTZLINE, EVAN GRACE',
                email: 'eportz30@gmail.com',
                variants: ['Evan Portzline', 'Evan', 'E. Portzline', 'Portzline']
            },
            {
                id: '4602',
                fullName: 'KEMPF, RYAN ELIZABETH',
                email: 'ryankpink@icloud.com',
                variants: ['Ryan Kempf', 'Ryan', 'R. Kempf', 'Kempf']
            },
            {
                id: '3915',
                fullName: 'DIAZ, ANGELA CLARICE',
                email: 'angela.diaz468@myci.csuci.edu',
                variants: ['Angela Diaz', 'Angela', 'A. Diaz', 'Diaz']
            },
            {
                id: '1089',
                fullName: 'SALAZAR, NATALIE',
                email: 'natalie.salazar427@myci.csuci.edu',
                variants: ['Natalie Salazar', 'Natalie', 'N. Salazar', 'Salazar']
            }
        ];

        function initializeStudentInputs() {
            const container = document.getElementById('studentInputs');

            STUDENTS_DATA.forEach((student, index) => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.fullName}</div>
                        <div class="student-id">ID: ${student.id}</div>
                    </div>

                    <div class="form-group">
                        <label for="email-${index}">Email del Estudiante:</label>
                        <input type="email" id="email-${index}" value="${student.email}" placeholder="student@ugr.es">
                    </div>

                    <div class="form-group">
                        <label>Vista Previa del Email:</label>
                        <div class="email-preview" id="preview-${index}">
                            <div class="email-subject">Asunto: Tu ID de Asistencia - Curso de Espa√±ol Oral B2.1</div>
                            <em>El email personalizado aparecer√° aqu√≠...</em>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="checkbox" id="sent-${index}" onchange="updateProgress()">
                        <label for="sent-${index}" style="margin: 0; font-size: 14px;">Email enviado</label>
                        <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px;" onclick="previewEmail(${index})">
                            üëÅÔ∏è Vista Previa
                        </button>
                        <button class="btn btn-success" style="padding: 6px 12px; font-size: 14px;" onclick="copyEmail(${index})">
                            üìã Copiar
                        </button>
                    </div>
                `;

                container.appendChild(card);

                // Generate initial preview with preloaded email
                generateEmailPreview(index);

                // Add email input listener
                document.getElementById(`email-${index}`).addEventListener('input', () => {
                    generateEmailPreview(index);
                });
            });
        }

        function generateEmailContent(student, email) {
            const subject = `Tu ID de Asistencia - Curso de Espa√±ol Oral B2.1 / Your Attendance ID for Spanish Oral Course B2.1`;

            const firstName = student.fullName.split(',')[1] || student.fullName.split(',')[0];

            const body = `¬°Hola ${firstName.trim()}! / Hello ${firstName.trim()}!

Bienvenido/a al curso de Producci√≥n Oral B2.1 en la Universidad de Granada!
Welcome to the Spanish Oral Production Course B2.1 at Universidad de Granada!

Te escribo para proporcionarte tu ID personal de asistencia para nuestro curso.
I'm writing to provide you with your personal attendance ID for our course.

üéØ **Tus Datos Personales / Your Personal Information:**
‚Ä¢ Nombre completo / Full Name: ${student.fullName}
‚Ä¢ ID de Estudiante / Student ID: ${student.id}
‚Ä¢ Variantes de nombre aceptadas / Accepted Name Variants: ${student.variants.join(', ')}

üì± **C√≥mo Registrar Tu Asistencia / How to Register Your Attendance:**

1Ô∏è‚É£ **Escanea el C√≥digo QR / Scan the QR Code:**
   - Busca el c√≥digo QR que se mostrar√° en clase
   - Usa la c√°mara de tu m√≥vil para escanearlo
   - Look for the QR code displayed in class
   - Use your phone's camera to scan it

2Ô∏è‚É£ **Rellena el Formulario / Fill the Form:**
   - Escribe tu nombre (puedes usar cualquiera de las variantes listadas)
   - Introduce tu ID de estudiante de 4 d√≠gitos: ${student.id}
   - Haz clic en "Registrar Asistencia"
   - Enter your name (you can use any of the variants listed above)
   - Enter your 4-digit Student ID: ${student.id}
   - Click "Registrar Asistencia"

3Ô∏è‚É£ **Confirmaci√≥n / Confirmation:**
   - Ver√°s un mensaje de √©xito con los detalles de tu registro
   - El sistema registra la hora exacta de tu llegada
   - Solo puedes registrarte una vez al d√≠a
   - You'll see a success message with your registration details
   - The system records the exact time of your arrival
   - You can only register once per day

‚ö†Ô∏è **Notas Importantes / Important Notes:**
‚Ä¢ Tu ID es √∫nico y confidencial - no lo compartas con otros
‚Ä¢ Your ID is unique and confidential - don't share it with others
‚Ä¢ Debes usar AMBOS: tu nombre (cualquier variante aceptada) Y tu ID correcto
‚Ä¢ You must use BOTH your name (any accepted variant) AND your correct ID
‚Ä¢ El sistema funciona con datos m√≥viles - no necesitas WiFi
‚Ä¢ The system works with mobile data - no WiFi needed
‚Ä¢ Reg√≠strate cuando llegues a clase
‚Ä¢ Make sure to register when you arrive at class

üîß **Si tienes problemas / If you have any issues:**
- Verifica que est√°s usando el ID correcto de 4 d√≠gitos
- Double-check that you're using the correct 4-digit ID
- Prueba usando una variante diferente de nombre de la lista
- Try using a different name variant from the list above
- Cont√°ctame si necesitas ayuda
- Contact me if you need assistance

¬°Espero verte en clase! / I look forward to seeing you in class!

Saludos cordiales / Best regards,
Javier Ben√≠tez L√°inez
Profesor de Espa√±ol / Spanish Language Professor
Centro de Lenguas Modernas
Universidad de Granada`;

            return { subject, body };
        }

        function generateEmailPreview(index) {
            const email = document.getElementById(`email-${index}`).value;
            const preview = document.getElementById(`preview-${index}`);
            const student = STUDENTS_DATA[index];

            if (!email) {
                preview.innerHTML = '<div class="email-subject">Asunto: Tu ID de Asistencia - Curso de Espa√±ol Oral B2.1</div><em>Introduce una direcci√≥n de email para ver el contenido personalizado...</em>';
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            preview.innerHTML = `
                <div class="email-subject">Asunto: ${subject}</div>
                <div style="white-space: pre-line;">${body}</div>
            `;
        }

        function previewEmail(index) {
            const email = document.getElementById(`email-${index}`).value;
            const student = STUDENTS_DATA[index];

            if (!email) {
                alert('Por favor, introduce una direcci√≥n de email primero.');
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>Para / To:</strong> ${email}<br>
                    <strong>Asunto / Subject:</strong> ${subject}
                </div>
                <div style="background: #f9fafb; padding: 20px; border-radius: 8px; white-space: pre-line; line-height: 1.6;">
                    ${body}
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="copyEmail(${index}); closeModal();">
                        üìã Copiar al Portapapeles / Copy to Clipboard
                    </button>
                </div>
            `;

            document.getElementById('emailModal').style.display = 'block';
        }

        function copyEmail(index) {
            const email = document.getElementById(`email-${index}`).value;
            const student = STUDENTS_DATA[index];

            if (!email) {
                alert('Por favor, introduce una direcci√≥n de email primero.');
                return;
            }

            const { subject, body } = generateEmailContent(student, email);

            const emailContent = `Para / To: ${email}
Asunto / Subject: ${subject}

${body}`;

            navigator.clipboard.writeText(emailContent).then(() => {
                alert('¬°Email copiado al portapapeles! Ahora puedes pegarlo en tu cliente de correo.');
            }).catch(err => {
                console.error('Error al copiar email: ', err);
                alert('Error al copiar email. Por favor, int√©ntalo de nuevo.');
            });
        }

        function generateAllEmails() {
            for (let i = 0; i < STUDENTS_DATA.length; i++) {
                generateEmailPreview(i);
            }

            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
        }

        function copyAllEmails() {
            let allEmails = '';
            let emailCount = 0;

            for (let i = 0; i < STUDENTS_DATA.length; i++) {
                const email = document.getElementById(`email-${i}`).value;
                const student = STUDENTS_DATA[i];

                if (email) {
                    const { subject, body } = generateEmailContent(student, email);
                    allEmails += `=== EMAIL ${++emailCount} ===
Para / To: ${email}
Asunto / Subject: ${subject}

${body}

========================

`;
                }
            }

            if (allEmails) {
                navigator.clipboard.writeText(allEmails).then(() => {
                    alert(`¬°${emailCount} emails copiados al portapapeles! Ahora puedes pegarlos en tu cliente de correo.`);
                });
            } else {
                alert('Por favor, introduce al menos una direcci√≥n de email primero.');
            }
        }

        function closeModal() {
            document.getElementById('emailModal').style.display = 'none';
        }

        function updateProgress() {
            // This function could be used to show progress of sent emails
            const total = STUDENTS_DATA.length;
            let sent = 0;

            for (let i = 0; i < total; i++) {
                if (document.getElementById(`sent-${i}`).checked) {
                    sent++;
                }
            }

            // You could update a progress bar here if desired
            console.log(`Progress: ${sent}/${total} emails sent`);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('emailModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeStudentInputs);
    </script>
</body>
</html>