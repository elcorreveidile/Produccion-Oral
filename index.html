<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Producci√≥n e Interacci√≥n Oral en Espa√±ol ‚Äî Nivel B2.1 (Avanzado Intermedio)</title>
  <style>
    :root{
      --fg:#1f2937; --bg:#ffffff; --border:#e5e7eb; --brand:#111827; --card:#ffffff;
      --s1:#e0f2fe; --s2:#fef3c7; --s3:#dcfce7; --s4:#fae8ff; --s5:#dbeafe;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:1rem}
    :target{scroll-margin-top:72px}

    /* NAV */
    .nav{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.96);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border)}
    .nav .inner{display:flex;gap:.5rem;align-items:center}
    .brand{font-weight:800;display:flex;align-items:center;gap:.75rem}
    .brand .logo{height:40px;width:auto;object-fit:contain}
    .spacer{flex:1}
    .links{display:flex;gap:.5rem;align-items:center}
    .links a{display:inline-block;padding:.5rem .75rem;border:1px solid var(--border);border-radius:9999px;background:#fff;white-space:nowrap}
    .hamb{display:none;appearance:none;border:1px solid var(--border);background:#fff;border-radius:.75rem;padding:.5rem .6rem}
    .mobile-panel{display:none;position:fixed;top:56px;left:0;right:0;background:#fff;border-bottom:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .mobile-panel .row{display:flex;overflow-x:auto;gap:.5rem;padding:.75rem 1rem}
    .mobile-panel a{display:inline-block;padding:.5rem .75rem;border:1px solid var(--border);border-radius:9999px;background:#fff;white-space:nowrap}

    /* Layout */
    .section{padding:3rem 0;position:relative;overflow:hidden}
    .section > .container{position:relative;z-index:1}
    /* Fondo con imagen opcional (velo 0.35) */
    .section::before{content:"";position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:cover;opacity:.35;z-index:0}
    #s1{background:var(--s1)} #s2{background:var(--s2)} #s3{background:var(--s3)} #s4{background:var(--s4)} #s5{background:var(--s5)}
    /* Si subes im√°genes a materials/img/s1.jpg...s5.jpg, se ver√°n sin tocar el HTML */
    #s1::before{background-image:url("materials/img/s1.jpg?v=1")} 
    #s2::before{background-image:url("materials/img/s2.jpg?v=1")} 
    #s3::before{background-image:url("materials/img/s3.jpg?v=1")} 
    #s4::before{background-image:url("materials/img/s4.jpg?v=1")} 
    #s5::before{background-image:url("materials/img/s5.jpg?v=1")} 

    h1{font-size:clamp(1.8rem,2.5vw,3rem);margin:.3rem 0}
    h2{font-size:clamp(1.5rem,2vw,2.2rem);margin:0 0 .5rem 0}
    h3{margin:.5rem 0}
    .muted{color:#374151;font-size:.95rem}
    .btn{display:inline-block;padding:.6rem 1rem;border-radius:9999px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .list{padding-left:1.1rem}
    .list li{margin:.35rem 0}
    .footer{border-top:1px solid var(--border);padding:1rem 0;color:#6b7280}
    .card{background:rgba(255,255,255,.92);border:1px solid var(--border);border-radius:1rem;padding:1rem}
    @media(max-width:899px){.card{background:rgba(255,255,255,.96)}}
    .grid{display:grid;gap:1rem}
    @media(min-width:900px){.grid-3{grid-template-columns: 1fr 1fr 1fr;}}
    .chip{display:inline-block;padding:.25rem .6rem;border:1px solid var(--border);border-radius:9999px;margin:.15rem .25rem;background:#fff;cursor:pointer}
    .chip.active{background:#111827;color:#fff;border-color:#111827}
    .hint{font-size:.9rem;color:#334155;margin:.25rem 0 .5rem}

    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid var(--border);padding:.6rem;text-align:left}
    th{background:#f8fafc}

    @media (max-width:899px){.links{display:none}.hamb{display:inline-block}.container{padding:.75rem 1rem}.section{padding:2rem 0}}
    .nav.open .mobile-panel{display:block}

    /* Visor PDF */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:50}
    .overlay.show{display:block}
    .viewer{position:fixed;inset:5% 3%;background:#111827;border-radius:1rem;box-shadow:0 25px 50px rgba(0,0,0,.35);display:none;flex-direction:column;z-index:60}
    .viewer .top{display:flex;align-items:center;gap:.5rem;padding:.6rem .75rem;background:#0f172a;color:#fff;border-top-left-radius:1rem;border-top-right-radius:1rem;flex-wrap:wrap}
    .viewer .top .spacer{flex:1}
    .viewer .btn{border-color:#334155;background:#fff;color:#0f172a;font-weight:600;padding:.45rem .8rem;border-radius:.65rem;text-decoration:none;display:inline-flex;align-items:center;gap:.4rem}
    .viewer iframe{flex:1;border:0;border-bottom-left-radius:1rem;border-bottom-right-radius:1rem;background:#fff}
    .viewer .content{flex:1;border-bottom-left-radius:1rem;border-bottom-right-radius:1rem;background:#fff;padding:2rem;overflow-y:auto;font-family:Georgia, serif;line-height:1.6;color:#1f2937}
    .viewer .content pre{white-space:pre-wrap;font-family:inherit;margin:0}
    .viewer .content h1{font-size:1.8rem;color:#111827;margin-bottom:1rem;border-bottom:2px solid #e5e7eb;padding-bottom:0.5rem}
    .viewer .content h2{font-size:1.4rem;color:#374151;margin-top:1.5rem;margin-bottom:0.75rem}
    .viewer .content h3{font-size:1.2rem;color:#4b5563;margin-top:1rem;margin-bottom:0.5rem}
    .viewer .content ul{margin:0.5rem 0;padding-left:1.5rem}
    .viewer .content li{margin:0.3rem 0}
    .viewer .content strong{color:#111827}
    @media (max-width:640px){ .viewer{inset:4% 2%} .viewer .btn{flex:1;justify-content:center;min-width:120px} #fileName{flex-basis:100%;font-size:1rem} .viewer .content{padding:1rem} }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="nav">
    <div class="container inner">
      <div class="brand">
    <img src="images/Logo-CLM-V1.jpg" alt="Logo CLM" class="logo">
    üó£Ô∏è Producci√≥n e Interacci√≥n Oral ‚Äî Nivel B2.1 (Avanzado)
  </div>
      <div class="spacer"></div>
      <div class="links" aria-label="Men√∫ principal">
        <a href="#s1">Gu√≠a</a>
        <a href="#s2">Competencias</a>
        <a href="#s3">Temario</a>
        <a href="#s4">Proyectos</a>
        <a href="#s5">Evaluaci√≥n</a>
        <a href="#descargas">Descargas</a>
        <a href="#foro">Foro</a>
        <a href="#taller">Taller</a>
      </div>
      <button class="hamb" id="hamb" aria-label="Abrir men√∫">‚ò∞</button>
    </div>
    <div class="mobile-panel" id="mobilePanel">
      <div class="row">
        <a href="#s1">Gu√≠a</a>
        <a href="#s2">Competencias</a>
        <a href="#s3">Temario</a>
        <a href="#s4">Proyectos</a>
        <a href="#s5">Evaluaci√≥n</a>
        <a href="#descargas">Descargas</a>
        <a href="#foro">Foro</a>
        <a href="#taller">Taller</a>
      </div>
    </div>
  </div>

  <!-- SECCI√ìN 1: GU√çA -->
  <section class="section" id="s1">
    <div class="container">
      <div id="current-date" style="text-align: center; font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-bottom: 1rem;"></div>
      <h2>üìò Gu√≠a del curso</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Datos clave</h3>
          <div id="qr-attendance" style="text-align: center; margin: 15px 0;">
            <h4 style="color: var(--primary-color); margin-bottom: 10px;">üì± Asistencia del D√≠a</h4>
            <div id="qr-code-container" style="background: white; padding: 15px; border-radius: 8px; display: inline-block; border: 2px solid var(--border-color);">
              <div id="qr-code"></div>
            </div>
            <div id="qr-timer" style="margin-top: 10px; font-weight: 600; color: var(--secondary-color);"></div>
            <p style="font-size: 0.9rem; color: var(--muted-color); margin-top: 10px;">
              Escanear con el m√≥vil para registrar asistencia
            </p>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 10px;">
              <button id="generate-new-qr" style="padding: 8px 16px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                Generar Nuevo C√≥digo
              </button>
              <button onclick="window.open('attendance-admin-v2.html', '_blank')" style="padding: 8px 16px; background: #1e40af; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                üìä Panel de Asistencia
              </button>
              <button id="open-pdf-generator" style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;" onclick="window.open('attendance-pdf.html', '_blank')">
                üìÑ Generar Hoja de Asistencia
              </button>
            </div>
          </div>
          <ul class="list">
            <li>2024/2025</li>
            <li>1 octubre ‚Äì 15 diciembre</li>
            <li>0701 ¬∑ 45 h ¬∑ 4,5 CTS ¬∑ Optativa</li>
            <li>Lunes y mi√©rcoles ¬∑ Aula A4</li>
            <li><b>Profesor:</b> Javier Ben√≠tez L√°inez</li>
            <li>L-X de 12:30 a 14:30</li>
            <li><b>Requisitos:</b> Prueba de nivel + B1 acreditado</li>
          </ul>
        </div>
        <div class="card">
          <h3>Objetivo general</h3>
          <p>Desarrollar la producci√≥n e interacci√≥n oral hasta un desempe√±o s√≥lido B2.1, alcanzando fluidez natural, precisi√≥n comunicativa y dominio de registros variados en contextos reales y profesionales.</p>
          <h3 style="margin-top:.75rem">Nivel del grupo: B2.1</h3>
          <p>Marco Com√∫n Europeo de Referencia (MCER) - Usuario Intermedio Alto. Los estudiantes pueden comprender las ideas principales de textos complejos, interactuar con cierta fluidez y espontaneidad, y producir textos claros y detallados sobre temas diversos.</p>
          <h3 style="margin-top:.75rem">Metodolog√≠a</h3>
          <p>Aprendizaje por tareas, integraci√≥n de destrezas, din√°mica de grupo e inmersi√≥n total (dentro y fuera del aula). Enfoque comunicativo con proyectos de cine, mini serie y experiencias culturales aut√©nticas.</p>
        </div>
        <div class="card">
          <h3>Gu√≠as de la sesi√≥n</h3>
          <p class="hint">Pulsa la sesi√≥n para abrir su gu√≠a (RTF).</p>
          <div id="chips-s1"></div>
          <ul class="list" id="lista-s1"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN 2: COMPETENCIAS -->
  <section class="section" id="s2">
    <div class="container">
      <h2>üéØ Competencias</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Comprensi√≥n</h3>
          <ul class="list">
            <li>Auditiva: conferencias, debates y noticias con registro est√°ndar.</li>
            <li>Lectora: instrucciones extensas, art√≠culos e informes con ideas principales y detalles.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Interacci√≥n y expresi√≥n</h3>
          <ul class="list">
            <li>Debates: postura, cortes√≠a, cohesi√≥n y cooperaci√≥n conversacional.</li>
            <li>Presentaciones: argumentos, ventajas/desventajas, claridad y matices.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Otras competencias</h3>
          <ul class="list">
            <li>Pragm√°tica, gramatical, fonol√≥gica y ortogr√°fica.</li>
            <li>Conciencia de la lengua para evitar malentendidos y ambig√ºedad.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN 3: TEMARIO -->
  <section class="section" id="s3">
    <div class="container">
      <h2>üóÇÔ∏è Temario</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Interacci√≥n</h3>
          <ul class="list">
            <li>Conocer a la clase.</li>
            <li>Intensificaci√≥n y atenuaci√≥n.</li>
            <li>T√∫/usted/vosotros/ustedes; cortes√≠a.</li>
            <li>Mostrar acuerdo y desacuerdo.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Expresi√≥n y estrategias</h3>
          <ul class="list">
            <li>Descripci√≥n de la personalidad.</li>
            <li>Definir y dar instrucciones.</li>
            <li>Repetir, contar y resumir lo dicho.</li>
            <li>Emociones, sentimientos y comunicaci√≥n no verbal.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Comprensi√≥n y proyectos</h3>
          <ul class="list">
            <li>Estrategias para cine, TV y documental.</li>
            <li>Recursos l√©xicos para distintos textos.</li>
            <li>Proyectos colaborativos de inmersi√≥n cultural.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN 4: PROYECTOS -->
  <section class="section" id="s4">
    <div class="container">
      <h2>üß≠ Proyectos</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Webquest ¬∑ Ruta de Tapas por Granada</h3>
          <p>Trabajo de campo en grupos de tres (historiador/a, reportero/a, experto/a gastron√≥mico). Documentaci√≥n de cultura del tapeo, entorno hist√≥rico-cultural y oferta gastron√≥mica.</p>
          <p><a class="btn" href="https://detapasporgranada.wordpress.com" target="_blank" rel="noopener">Abrir la ruta</a></p>
          <ul class="list">
            <li>Producto final: presentaci√≥n oral multimedia.</li>
            <li>Informes individuales y receta.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Aula de Cine ¬∑ "Para mudarse a Espa√±a"</h3>
          <ul class="list">
            <li>Creaci√≥n de personajes, guion, registro y entonaci√≥n.</li>
            <li>Interpretaci√≥n, grabaci√≥n y subtitulado.</li>
            <li>Producto final: cap√≠tulo grabado + guion y reflexi√≥n.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Criterios de valoraci√≥n</h3>
          <ul class="list">
            <li>Interacci√≥n real fuera del aula.</li>
            <li>Precisi√≥n l√©xica (historia, cultura, gastronom√≠a).</li>
            <li>Recursos visuales y entrevistas.</li>
            <li>Fluidez, espontaneidad y organizaci√≥n.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN 5: EVALUACI√ìN -->
  <section class="section" id="s5">
    <div class="container">
      <h2>üìä Evaluaci√≥n</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Asistencia</h3>
          <p>Al menos el 80% de las clases para ser evaluado/a.</p>
          <h3 style="margin-top:.5rem">Sistema espa√±ol</h3>
          <p>Sobresaliente (9‚Äì10), Notable (7‚Äì8.99), Aprobado (5‚Äì6.99), Suspenso (0‚Äì4.99).</p>
        </div>
        <div class="card">
          <h3>60% ¬∑ Evaluaci√≥n continua</h3>
          <ul class="list">
            <li>Participaci√≥n activa y progreso.</li>
            <li>Pr√°cticas en aula y fuera.</li>
            <li>Proyecto Ruta de Tapas (grupal e individual).</li>
            <li>Proyecto Aula de Cine.</li>
          </ul>
        </div>
        <div class="card">
          <h3>40% ¬∑ Pruebas orales</h3>
          <ul class="list">
            <li>Parcial y final con tareas orales.</li>
            <li>Conciencia y adecuaci√≥n como nuevos hablantes.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- DESCARGAS -->
  <section class="section" id="descargas">
    <div class="container">
      <h2>üì• Descargas</h2>
      <div class="card">
        <table>
          <thead><tr><th>Documento</th><th>Acci√≥n</th></tr></thead>
          <tbody>
            <tr><td>Gu√≠a docente (PDF)</td><td><button class="btn" data-pdf="materials/guia-docente.pdf">Abrir/descargar</button></td></tr>
            <tr><td>Programa detallado (PDF)</td><td><button class="btn" data-pdf="materials/programa-detallado.pdf">Abrir/descargar</button></td></tr>
            <tr><td>R√∫bricas de evaluaci√≥n (PDF)</td><td><button class="btn" data-pdf="materials/rubricas.pdf">Abrir/descargar</button></td></tr>
          </tbody>
        </table>
        <p class="muted" style="margin-top:.4rem">Sube tus PDF a <code>materials/</code> con estos nombres o c√°mbialos aqu√≠.</p>
      </div>
    </div>
  </section>

  <!-- FORO -->
  <section class="section" id="foro">
    <div class="container">
      <h2>üí¨ Foro</h2>
      <div class="card">
        <p>Usaremos el foro/plataforma del centro.</p>
        <p><a class="btn primary" href="#" target="_blank" rel="noreferrer">Abrir foro</a></p>
      </div>
    </div>
  </section>

  <!-- TALLER (plantilla de guion/actividad descargable) -->
  <section class="section" id="taller">
    <div class="container">
      <h2>üõ†Ô∏è Taller</h2>
      <div class="card">
        <div class="grid" style="grid-template-columns:1fr;gap:1rem">
          <label>Actividad
            <select id="obra">
              <option>Presentaci√≥n oral</option>
              <option>Entrevista</option>
              <option>Debate</option>
              <option>Guion mini serie</option>
            </select>
          </label>
          <label>T√≠tulo
            <input id="titulo" placeholder="Ej.: Opiniones sobre turismo" />
          </label>
          <label>Descripci√≥n breve
            <input id="sinopsis" placeholder="Una l√≠nea que resuma la tarea" />
          </label>
          <label>Guion / texto
            <textarea id="guion"></textarea>
          </label>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn primary" id="guardar">Descargar .txt</button>
            <button class="btn" id="plantilla">Cargar plantilla</button>
            <button class="btn" id="limpiar">Limpiar</button>
          </div>
        </div>
        <p class="muted" style="margin-top:.75rem">La descarga funciona sin servidor: genera un archivo de texto al momento.</p>
      </div>
    </div>
  </section>

  <footer class="footer"><div class="container">¬© <span id="y"></span> Producci√≥n e Interacci√≥n Oral ‚Äî Nivel B2.1 (Avanzado) ¬∑ Universidad de Granada</div></footer>

  <!-- Visor de Documentos -->
  <div class="overlay" id="overlay"></div>
  <div class="viewer" id="viewer">
    <div class="top">
      <strong id="fileName">Documento</strong>
      <div class="spacer"></div>
      <a class="btn" id="openTab" target="_blank" rel="noopener">Abrir en pesta√±a</a>
      <a class="btn" id="download" download>Descargar</a>
      <button class="btn primary" id="closeViewer">Volver</button>
    </div>
    <iframe id="frame" title="Visor PDF" src="about:blank" style="display:none;"></iframe>
    <div id="textcontent" class="content" style="display:none;"></div>
  </div>

  <script>
    // A√±o
    document.getElementById('y').textContent = new Date().getFullYear();

    // Men√∫ m√≥vil
    const nav = document.getElementById('nav');
    const hamb = document.getElementById('hamb');
    hamb?.addEventListener('click', ()=> nav.classList.toggle('open'));
    document.querySelectorAll('#mobilePanel a').forEach(a=> a.addEventListener('click', ()=> nav.classList.remove('open')));

    // Visor de Documentos
    const overlay = document.getElementById('overlay');
    const viewer = document.getElementById('viewer');
    const frame = document.getElementById('frame');
    const textcontent = document.getElementById('textcontent');
    const openTab = document.getElementById('openTab');
    const download = document.getElementById('download');
    const fileName = document.getElementById('fileName');
    const closeViewer = document.getElementById('closeViewer');

    function formatTextContent(text) {
      // Convertir texto plano a HTML con formato
      let formatted = text
        .replace(/\n\n+/g, '</p><p>')
        .replace(/^\S+/m, '<p>')
        .replace(/([A-Z][A-Z√Å-√ö\s]+:)/g, '<strong>$1</strong>')
        .replace(/SESI√ìN (\d+):/g, '<h1>SESI√ìN $1:')
        .replace(/(\d+\.\s[^:]+:)/g, '<h2>$1</h2>')
        .replace(/^‚Ä¢\s(.+)$/gm, '<li>$1</li>')
        .replace(/^- (.+)$/gm, '<li>$1</li>');

      // Envolver listas
      formatted = formatted.replace(/(<li>.*?<\/li>)/gs, '<ul>$1</ul>');
      formatted += '</p>';

      return formatted;
    }

    async function openDocument(path){
      fileName.textContent = decodeURIComponent(path.split('/').pop());
      const extension = path.split('.').pop().toLowerCase();

      openTab.href = path;
      download.href = path;
      overlay.classList.add('show');
      viewer.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      if (extension === 'pdf') {
        // Mostrar PDF en iframe
        frame.style.display = 'block';
        textcontent.style.display = 'none';
        frame.src = path;
      } else if (extension === 'txt' || extension === 'rtf') {
        // Mostrar texto con formato
        frame.style.display = 'none';
        textcontent.style.display = 'block';

        try {
          const response = await fetch(path);
          if (!response.ok) throw new Error('No se pudo cargar el archivo');

          let text = await response.text();

          // Si es RTF, eliminar c√≥digo RTF b√°sico
          if (extension === 'rtf') {
            text = text.replace(/\\[^a-zA-Z]+\d*/g, '')
                      .replace(/\{[^}]*\}/g, '')
                      .replace(/\\par/g, '\n')
                      .replace(/\\tab/g, '  ')
                      .replace(/\\'d[0-9a-fA-F]{2}/g, '')
                      .replace(/\\[a-zA-Z]+\s*/g, '');
          }

          textcontent.innerHTML = formatTextContent(text);
        } catch (error) {
          textcontent.innerHTML = `<p>Error al cargar el documento: ${error.message}</p>`;
        }
      } else {
        // Para otros tipos, abrir en nueva pesta√±a
        window.open(path, '_blank');
        closeDocument();
      }
    }

    function closeDocument(){
      overlay.classList.remove('show');
      viewer.style.display = 'none';
      frame.src = 'about:blank';
      textcontent.innerHTML = '';
      document.body.style.overflow = '';
    }

    overlay.addEventListener('click', closeDocument);
    closeViewer.addEventListener('click', closeDocument);

    // Delegaci√≥n: cualquier [data-pdf] o [data-doc] abre visor
    document.addEventListener('click', (e)=>{
      const target = e.target.closest('[data-pdf], [data-doc]');
      if(target){
        e.preventDefault();
        const path = target.getAttribute('data-pdf') || target.getAttribute('data-doc');
        openDocument(path);
      }
    });

    // ===== GU√çAS POR SESI√ìN (SECCI√ìN 1) =====
    // Sube PDFs a materials/cuadernos/ con estos nombres o c√°mbialos aqu√≠
    const GUIAS_S1 = [
      { t: 'Sesi√≥n 1 ¬∑ Poes√≠a - Javier Egea (completada)', href: 'materials/cuadernos/S1_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 2 ¬∑ Ruta de tapas (completada)', href: 'materials/cuadernos/S2_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 3 ¬∑ Situaci√≥n: Buscar piso en Granada', href: 'materials/cuadernos/S3_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 4 ¬∑ Debate: Cultura de tapas vs. comida r√°pida', href: 'materials/cuadernos/S4_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 5 ¬∑ Situaci√≥n: En el mercado municipal', href: 'materials/cuadernos/S5_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 6 ¬∑ Debate: ¬øEstudiar o trabajar en el extranjero?', href: 'materials/cuadernos/S6_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 7 ¬∑ Situaci√≥n: Problemas con el vecindario', href: 'materials/cuadernos/S7_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 8 ¬∑ Debate: Tradici√≥n vs. modernidad en Espa√±a', href: 'materials/cuadernos/S8_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 9 ¬∑ Situaci√≥n: Preparar una cena espa√±ola', href: 'materials/cuadernos/S9_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 10 ¬∑ Debate: Turismo sostenible en Granada', href: 'materials/cuadernos/S10_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 11 ¬∑ Situaci√≥n: Emergencia m√©dica', href: 'materials/cuadernos/S11_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 12 ¬∑ Debate: Redes sociales y relaciones', href: 'materials/cuadernos/S12_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
      { t: 'Sesi√≥n 13 ¬∑ Presentaci√≥n final: Proyecto mini serie', href: 'materials/cuadernos/S13_Produccion_Oral_Mejorado.pdf', type: 'pdf' },
    ];

    // Lista de sesiones que tienen PDFs generados (actualizado a 2025)
    const SESSIONS_AVAILABLE = [
      'S1_Produccion_Oral_Mejorado.pdf',
      'S2_Produccion_Oral_Mejorado.pdf',
      'S3_Produccion_Oral_Mejorado.pdf',
      'S4_Produccion_Oral_Mejorado.pdf',
      'S5_Produccion_Oral_Mejorado.pdf',
      'S6_Produccion_Oral_Mejorado.pdf',
      'S7_Produccion_Oral_Mejorado.pdf',
      'S8_Produccion_Oral_Mejorado.pdf',
      'S9_Produccion_Oral_Mejorado.pdf',
      'S10_Produccion_Oral_Mejorado.pdf',
      'S11_Produccion_Oral_Mejorado.pdf',
      'S12_Produccion_Oral_Mejorado.pdf',
      'S13_Produccion_Oral_Mejorado.pdf'
    ];

    function renderGuiasS1(){
      const chips = document.getElementById('chips-s1');
      const list = document.getElementById('lista-s1');
      chips.innerHTML = ''; list.innerHTML = '';

      GUIAS_S1.forEach((s) => {
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = s.t;

        span.onclick = () => {
          document.querySelectorAll('#chips-s1 .chip').forEach(c=>c.classList.remove('active'));
          span.classList.add('active');

          // Verificar si el archivo est√° disponible usando la lista manual
          const fileName = s.href.split('/').pop();
          const fileExists = SESSIONS_AVAILABLE.includes(fileName);

          if (fileExists) {
            // Archivo existe - mostrar opciones de descarga/visualizaci√≥n
            const isPDF = s.type === 'pdf' || s.href.endsWith('.pdf');
            const fileIcon = isPDF ? 'üìÑ' : 'üìù';
            const dataAttr = isPDF ? 'data-pdf' : 'data-doc';

            list.innerHTML = `
              <li><button class="btn primary" ${dataAttr}="${s.href}">${fileIcon} Ver en navegador (${s.t})</button></li>
              <li><button class="btn" onclick="window.open('${s.href}', '_blank')">üîó Abrir en nueva pesta√±a</button></li>
              <li><button class="btn" onclick="downloadFile('${s.href}', '${s.t}.pdf')">üíæ Descargar directamente</button></li>
            `;
          } else {
            // Archivo no existe - mostrar mensaje informativo
            list.innerHTML = `
              <li class="muted">üìù ${s.t}</li>
              <li class="muted" style="font-size: 0.9rem; margin-top: 10px;">
                ‚ö†Ô∏è Este material estar√° disponible pr√≥ximamente.<br>
                Todas las sesiones 1-13 ya est√°n disponibles en PDF de alta calidad.
              </li>
              ${s.href.includes('S1') || s.href.includes('S2') || s.href.includes('S3') ?
                '<li><button class="btn" onclick="window.open(\'materials/cuadernos/' + s.href.split('/').pop().replace('Produccion_Oral', 'txt') + '\', \'_blank\')">üìÑ Ver versi√≥n original (.txt)</button></li>' :
                ''}
            `;
          }
        };
        chips.appendChild(span);
      });

      if(GUIAS_S1[0]) setTimeout(()=> chips.querySelector('.chip')?.click(), 0);
      else list.innerHTML = '<li class="muted">No hay gu√≠as subidas todav√≠a.</li>';
    }

    // Funci√≥n para descargar archivos directamente
    function downloadFile(url, filename) {
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // Sistema de Asistencia QR
    let qrTimer;
    let currentToken;
    let timeRemaining = 300; // 5 minutes

    function generateToken() {
      const timestamp = Date.now();
      const random = Math.random().toString(36).substring(7);
      return `${timestamp}-${random}`;
    }

    function generateQR() {
      currentToken = generateToken();

      // Generate session ID
      const now = new Date();
      const date = now.toISOString().split('T')[0]; // YYYY-MM-DD
      const time = now.toTimeString().split(' ')[0].substring(0, 5); // HH:MM
      const sessionId = `${date}_${time}`;

      // Create QR data for new system
      const qrData = {
        sessionId: sessionId,
        timestamp: now.toISOString(),
        type: 'attendance'
      };

      const baseUrl = 'https://elcorreveidile.github.io';
      const attendanceUrl = `${baseUrl}/Produccion-Oral/attendance-register-v2.html?qr=${encodeURIComponent(JSON.stringify(qrData))}`;

      // Clear previous QR
      document.getElementById('qr-code').innerHTML = '';

      // Generate new QR
      new QRCode(document.getElementById('qr-code'), {
        text: attendanceUrl,
        width: 200,
        height: 200,
        colorDark: '#1e40af',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });

      // Save QR data to localStorage for admin panel
      localStorage.setItem('currentQRData', JSON.stringify(qrData));
      localStorage.setItem('currentSession', JSON.stringify({
        sessionId: sessionId,
        timestamp: now.toISOString(),
        date: now.toDateString()
      }));

      // Reset timer
      timeRemaining = 300;
      startQRTimer();
    }

    function startQRTimer() {
      // Clear existing timer
      if (qrTimer) {
        clearInterval(qrTimer);
      }

      const timerElement = document.getElementById('qr-timer');

      qrTimer = setInterval(() => {
        if (timeRemaining <= 0) {
          clearInterval(qrTimer);
          generateQR(); // Auto-refresh when expired
          return;
        }

        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timerElement.textContent = `Expira en: ${minutes}:${seconds.toString().padStart(2, '0')}`;

        // Change color when less than 1 minute
        if (timeRemaining < 60) {
          timerElement.style.color = '#dc2626';
        } else {
          timerElement.style.color = 'var(--secondary-color)';
        }

        timeRemaining--;
      }, 1000);
    }

    function initQRSystem() {
      const qrContainer = document.getElementById('qr-attendance');
      const generateBtn = document.getElementById('generate-new-qr');

      if (qrContainer) {
        // Generate initial QR
        generateQR();

        // Setup manual refresh button
        if (generateBtn) {
          generateBtn.addEventListener('click', () => {
            generateQR();
          });
        }

        // Auto-refresh every 5 minutes
        setInterval(() => {
          generateQR();
        }, 5 * 60 * 1000); // 5 minutes
      }
    }

    // Mostrar fecha actual
    function updateCurrentDate() {
      const dateElement = document.getElementById('current-date');
      if (dateElement) {
        const today = new Date();
        const days = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
        const months = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];

        const dayName = days[today.getDay()];
        const day = today.getDate();
        const monthName = months[today.getMonth()];
        const year = today.getFullYear();

        dateElement.textContent = `Hoy es ${dayName}, ${day} de ${monthName} de ${year}`;
      }
    }

    // Inicializar todo cuando se carga la p√°gina
    updateCurrentDate();
    initQRSystem();
    renderGuiasS1();
  </script>
</body>
</html>
